#!/usr/bin/env ruby

require 'gitpusher'
require 'optparse'

options = {}
op = OptionParser.new do |opts|
  opts.on('-c', '--config FILE') do |file|
    options[:config] = file
  end
  opts.on('-t', '--thread COUNT', OptionParser::DecimalInteger) do |count|
    options[:threads] = [1, count].max
  end
end

op.parse!

options[:config] ||= 'config/default.yml'
options[:threads] ||= 1

context = GitPusher::Context.instance
context.home = File.join(File.dirname(__FILE__), '..')

GitPusher::Config.load(options)

GitPusher::Runner.run

